### 轮询
### websocket
引入依赖
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
```
配置类WebsocketConfig
```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.socket.config.annotation.EnableWebSocket;
import org.springframework.web.socket.server.standard.ServerEndpointExporter;

@Configuration
@EnableWebSocket
public class WebsocketConfig {

    @Bean
    public ServerEndpointExporter serverEndpointExporter() {
        return new ServerEndpointExporter();
    }
}
```
端点类WsServerEndpoint
```java
import com.alibaba.fastjson.JSON;
import com.catkissfish.major.customer.pojo.BatchOperationResponse;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.collections4.CollectionUtils;
import org.springframework.stereotype.Component;

import javax.websocket.*;
import javax.websocket.server.ServerEndpoint;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

@ServerEndpoint(value = "/batchOperationResponse", decoders = {BatchOperationResponseJsonDecoder.class}, encoders = {BatchOperationResponseJsonEncoder.class})
@Component
@Slf4j
public class WsServerEndpoint {

    private Session current;

    private static final List<Session> SESSION_LIST = new ArrayList<>();


    @OnOpen
    public void onOpen(Session session) {
        this.current = session;
        SESSION_LIST.add(session);
        log.info("连接成功，sessionId:{}", session.getId());
    }

    @OnMessage
    public void onMessage(BatchOperationResponse response) throws IOException, EncodeException {
        if ("-1".equals(response.getBatchOperationId())) {
            // 当接收到heart时，返回心跳成功信息
            current.getBasicRemote().sendText("心跳成功");
            return;
        }
        log.error("客户端：{},待通知结果：{}", SESSION_LIST, JSON.toJSONString(response));
        if (CollectionUtils.isNotEmpty(SESSION_LIST)) {
            for (Session session : SESSION_LIST) {
                session.getBasicRemote().sendObject(response);
            }
        }
    }

    @OnClose
    public void onClose() {
        log.info("连接关闭，sessionId:{}", current.getId());
    }

    @OnError
    public void onError(Throwable error) {
        log.error(error.getMessage());
    }
}
```
自定义编码类
```java
import com.alibaba.fastjson.JSON;
import com.catkissfish.major.customer.pojo.BatchOperationResponse;

import javax.websocket.Encoder;
import javax.websocket.EndpointConfig;

/**
 * @author admin
 * @date 2024/5/21 17:13
 */
public class BatchOperationResponseJsonEncoder implements Encoder.Text<BatchOperationResponse>{

    @Override
    public String encode(BatchOperationResponse response) {
        return JSON.toJSONString(response);
    }

    @Override
    public void init(EndpointConfig endpointConfig) {

    }

    @Override
    public void destroy() {

    }
}
```
自定义解码类
```java
import com.alibaba.fastjson2.JSON;
import com.catkissfish.major.customer.pojo.BatchOperationResponse;
import org.apache.commons.lang3.StringUtils;

import javax.websocket.Decoder;
import javax.websocket.EndpointConfig;

public class BatchOperationResponseJsonDecoder implements Decoder.Text<BatchOperationResponse>{
    @Override
    public BatchOperationResponse decode(String s) {
        if ("heart".equals(s)) {
            BatchOperationResponse response = new BatchOperationResponse();
            response.setBatchOperationId("-1");
            return response;
        }
        return JSON.parseObject(s, BatchOperationResponse.class);
    }

    @Override
    public boolean willDecode(String s) {
        return StringUtils.isNotBlank(s);
    }

    @Override
    public void init(EndpointConfig endpointConfig) {

    }

    @Override
    public void destroy() {

    }
}
```
使用在其他类注入WsServerEndpoint，直接调用onMessage(BatchOperationResponse response)

测试,使用在线websocket测试工具,例如http://coolaf.com/tool/chattest访问 ws://192.168.110.201:9001/batchOperationResponse
### SSE