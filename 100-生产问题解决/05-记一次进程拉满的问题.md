### 背景:
```text
项目出现错误: Handler dispatch failed; nested exception is java.lang.OutOfMemoryError: unable to create new native thread
服务器出现错误: -bash: fork: retry: No child processes
```

错误表明是系统无法再创建新的进程, 原因通常是 系统资源耗尽.

原因1: 系统线程数已达上限
```shell
# 查一下当前进程数
ps aux | wc -l
# 查看用户最大进程限制
ulimit -u
# 找出疯狂占进程的程序
ps -ef | awk '{print $1}' | sort | uniq -c | sort -nr | head
# 终止该进程
kill -9 PID
```

原因2: 系统里文件描述符（FD）爆了,也就是文件句柄耗尽
```shell
# 查看当前系统文件描述符使用情况
cat /proc/sys/fs/file-nr
# 返回3个数字
# 当前已分配FD数 未使用FD数 最大可分配FD数
# 如果第一个数字非常大（几十万、几百万），那就是FD爆了。
# 查看每个进程的FD数量（最关键）
for pid in /proc/[0-9]*; do   echo "$(ls -l $pid/fd 2>/dev/null | wc -l) $pid"; done | sort -nr | head
ps -fp pid
kill -9 pid
```

原因3: 线程数量爆了
```shell
# 列出每个进程的线程数量（最关键）
for pid in /proc/[0-9]*; do   th=$(ls -1 $pid/task 2>/dev/null | wc -l);   echo "$th $pid"; done | sort -nr | head
ps -fp pid
kill -9 pid
```
